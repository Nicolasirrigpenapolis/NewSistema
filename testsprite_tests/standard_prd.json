{
  "meta": {
    "project": "NewSistema",
    "date": "2025-10-04",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "NewSistema is a comprehensive transport management system focusing on the issuance and management of Electronic Manifest of Tax Documents (MDF-e). It centralizes logistics, fleet, driver, client, and supplier operations, ensuring fiscal compliance with real-time operational visibility.",
  "core_goals": [
    "Facilitate fast and reliable issuance of MDF-e",
    "Centralize transport operation management",
    "Ensure fiscal and legal compliance",
    "Optimize fleet and driver management",
    "Provide operational visibility via dashboards and reports"
  ],
  "key_features": [
    "JWT-based user authentication and role-based permission control with automatic token renewal",
    "Full lifecycle management of MDF-e including emission, validation, SEFAZ integration via ACBr library, INI file generation, filtered listing, detailed views, and status tracking",
    "CRUD operations for core entities: Emitentes, Veículos, Condutores, Reboques, Contratantes, Seguradoras, Municípios (with IBGE import), and Fornecedores",
    "Operational management features including travel recording, vehicle maintenance tracking, route management, and dashboards with statistics",
    "Comprehensive reporting with filters and export options covering expenses and maintenance",
    "Auxiliary features such as external CNPJ consultation, location searches, paginated lists, form validations, input masks, and UI components with dark/light themes",
    "Administration capabilities including user and role management, permission presets, and company configuration"
  ],
  "user_flow_summary": [
    "Users start at the /login page to authenticate using credentials; session is managed via JWT tokens with auto-renewal and expiration alerts",
    "Post-login, users land on the /dashboard to view key statistics and recent activities",
    "Users navigate to entity management pages (/veiculos, /condutores, /emitentes, etc.) to perform CRUD operations",
    "For MDF-e, users access /mdfes for listing and filtering documents, and /mdfe-editor for creating or editing documents, with backend integration to SEFAZ",
    "Operational users track travels and vehicle maintenance via /viagens and /manutencoes pages",
    "Administrators manage users and permissions via /admin/usuarios and /admin/cargos, and configure system and company settings through dedicated configuration pages"
  ],
  "validation_criteria": [
    "Successful authentication with JWT and proper permission enforcement",
    "MDF-e emissions validated before sending and correctly reflected in system status (Pending, Authorized, Cancelled, Rejected)",
    "All CRUD operations functional across entities with proper data integrity",
    "Reports generated accurately with correct filtering and export capabilities",
    "External API integrations for CNPJ and IBGE data functional and data accurately imported",
    "Responsive UI with functional theme switching and form validations",
    "System performance meets response time requirements (API <2s, dashboard <3s)",
    "Security measures such as BCrypt password hashing, HTTPS communication, and token expiration properly implemented",
    "System reliability with 99% uptime, daily backups, and audit logging ensured",
    "Administration features including permission matrix, presets, and user management operate correctly"
  ],
  "code_summary": {
    "project_name": "NewSistema",
    "description": "Sistema de gestão de transportes com emissão de MDF-e (Manifesto Eletrônico de Documentos Fiscais)",
    "tech_stacks": {
      "frontend": {
        "framework": "React 18.3.1",
        "language": "TypeScript 4.9.5",
        "build_tool": "react-scripts 5.0.1",
        "styling": "Tailwind CSS 3.4.17",
        "routing": "react-router-dom 7.9.1",
        "state_management": "React Query (@tanstack/react-query 5.90.2)",
        "ui_components": [
          "Radix UI (dialog, select, dropdown-menu, tabs, etc)",
          "lucide-react (icons)",
          "class-variance-authority"
        ],
        "dev_server_port": 3000
      },
      "backend": {
        "framework": ".NET 8.0",
        "language": "C#",
        "database": "SQL Server (Entity Framework Core 8.0.10)",
        "authentication": "JWT Bearer (Microsoft.AspNetCore.Authentication.JwtBearer)",
        "identity": "ASP.NET Core Identity",
        "api_documentation": "Swagger/Swashbuckle",
        "pdf_generation": "QuestPDF, iTextSharp",
        "excel_generation": "ClosedXML",
        "password_hashing": "BCrypt.Net-Next",
        "api_versioning": "Asp.Versioning.Mvc",
        "external_libraries": "ACBrMDFe64.dll (Biblioteca ACBr para emissão de MDF-e)",
        "server_port": 5000,
        "server_port_https": 5001
      }
    },
    "features": [
      {
        "category": "Autenticação e Autorização",
        "items": [
          "Sistema de login com JWT",
          "Gerenciamento de usuários",
          "Sistema de permissões baseado em cargos",
          "Controle de acesso granular",
          "Token monitoring e renovação automática",
          "Presets de permissões"
        ]
      },
      {
        "category": "Gestão de MDF-e",
        "items": [
          "Emissão de Manifesto Eletrônico de Documentos Fiscais (MDF-e)",
          "Listagem de MDF-es com filtros",
          "Visualização detalhada de MDF-e",
          "Acompanhamento de status (Pendente, Autorizado, Cancelado, Rejeitado)",
          "Geração de arquivo INI para ACBr",
          "Integração com biblioteca ACBr para comunicação com SEFAZ"
        ]
      },
      {
        "category": "Cadastros Básicos",
        "items": [
          "CRUD de Emitentes (empresas emissoras)",
          "CRUD de Veículos",
          "CRUD de Condutores (motoristas)",
          "CRUD de Reboques",
          "CRUD de Contratantes (clientes)",
          "CRUD de Seguradoras",
          "CRUD de Municípios com importação de dados IBGE",
          "CRUD de Fornecedores"
        ]
      },
      {
        "category": "Gestão Operacional",
        "items": [
          "Gerenciamento de viagens",
          "Controle de manutenções de veículos",
          "Acompanhamento de rotas",
          "Dashboard com estatísticas e atividades recentes"
        ]
      },
      {
        "category": "Relatórios",
        "items": [
          "Relatório de despesas",
          "Relatório de manutenções",
          "Exportação em diferentes formatos"
        ]
      },
      {
        "category": "Funcionalidades Auxiliares",
        "items": [
          "Consulta de CNPJ via API externa",
          "Busca de localidades (estados, municípios)",
          "Sistema de paginação para listagens",
          "Tema claro/escuro",
          "Campos opcionais configuráveis nos formulários",
          "Validações de formulários",
          "Máscaras de input (CNPJ, CPF, etc)",
          "Componentes de UI reutilizáveis"
        ]
      },
      {
        "category": "Administração",
        "items": [
          "Configuração de empresa/emitente",
          "Gerenciamento de cargos e permissões",
          "Matriz de permissões visual",
          "Configurações gerais do sistema"
        ]
      }
    ],
    "main_pages": [
      "/login - Página de autenticação",
      "/dashboard - Dashboard principal com estatísticas",
      "/mdfes - Listagem de MDF-es",
      "/mdfe-editor - Formulário de emissão de MDF-e",
      "/veiculos - Gerenciamento de veículos",
      "/condutores - Gerenciamento de condutores",
      "/emitentes - Gerenciamento de emitentes",
      "/contratantes - Gerenciamento de contratantes",
      "/seguradoras - Gerenciamento de seguradoras",
      "/municipios - Gerenciamento de municípios",
      "/fornecedores - Gerenciamento de fornecedores",
      "/reboques - Gerenciamento de reboques",
      "/manutencoes - Gestão de manutenções",
      "/viagens - Gestão de viagens",
      "/relatorios - Relatórios diversos",
      "/admin/usuarios - Administração de usuários",
      "/admin/cargos - Administração de cargos e permissões",
      "/configuracoes/emitente - Configurações do emitente"
    ],
    "api_endpoints": [
      "/api/auth - Autenticação",
      "/api/usuarios - Usuários",
      "/api/cargos - Cargos",
      "/api/permissoes - Permissões",
      "/api/emitentes - Emitentes",
      "/api/veiculos - Veículos",
      "/api/condutores - Condutores",
      "/api/contratantes - Contratantes",
      "/api/seguradoras - Seguradoras",
      "/api/municipios - Municípios",
      "/api/reboques - Reboques",
      "/api/fornecedores - Fornecedores",
      "/api/mdfe - MDF-e",
      "/api/manutencoes - Manutenções",
      "/api/viagens - Viagens",
      "/api/rotas - Rotas",
      "/api/relatorios - Relatórios",
      "/api/validation - Validações",
      "/api/entities - Entidades genéricas"
    ],
    "key_contexts": [
      "AuthContext - Gerenciamento de autenticação e sessão",
      "PermissionContext - Controle de permissões do usuário",
      "EmpresaContext - Contexto da empresa selecionada",
      "ThemeContext - Gerenciamento de tema claro/escuro"
    ],
    "external_integrations": [
      "API IBGE - Importação de dados de municípios",
      "API de consulta CNPJ - Preenchimento automático de dados empresariais",
      "SEFAZ - Comunicação via biblioteca ACBr para envio de MDF-e"
    ]
  }
}
